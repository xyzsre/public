# ConfigMap and Secret Pod Example
# Demonstrates multiple ways to consume ConfigMaps and Secrets:
# 1. Environment variables from ConfigMap/Secret keys
# 2. Mounted volumes containing all ConfigMap/Secret data

apiVersion: v1                    # API version for Pod resources
kind: Pod                        # Resource type: Pod

metadata:                        # Metadata about the Pod
  name: config-secret-pod        # Unique name for the pod

spec:                           # Pod specification
  containers:                   # List of containers
  - name: app                   # Container name
    image: busybox              # Container image
    command: ['sh', '-c', 'echo "Config value: $CONFIG_VALUE" && echo "Secret value: $SECRET_VALUE" && sleep 3600']
                                # Command that uses environment variables from ConfigMap/Secret

    env:                        # Environment variables
    - name: CONFIG_VALUE        # Environment variable name
      valueFrom:                # Source value from Kubernetes resource
        configMapKeyRef:        # Reference to ConfigMap key
          name: demo-config     # ConfigMap name
          key: app.setting      # Key within ConfigMap

    - name: SECRET_VALUE        # Environment variable name
      valueFrom:                # Source value from Kubernetes resource
        secretKeyRef:           # Reference to Secret key
          name: demo-secret     # Secret name
          key: password         # Key within Secret (value will be base64 decoded)

    volumeMounts:               # Volume mounts for accessing all data
    - name: config-volume       # Volume name reference
      mountPath: /etc/config    # Mount path inside container
    - name: secret-volume       # Volume name reference
      mountPath: /etc/secret    # Mount path inside container

  volumes:                      # Volume definitions
  - name: config-volume         # Volume name
    configMap:                 # ConfigMap volume source
      name: demo-config         # ConfigMap to mount
                               # Creates files for each key-value pair

  - name: secret-volume         # Volume name
    secret:                    # Secret volume source
      secretName: demo-secret   # Secret to mount
                               # Creates files for each key-value pair
                               # File permissions default to 0644
